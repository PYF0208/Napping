@model IEnumerable<Napping_PJ.Areas.Admin.Models.RoomsViewModel>


@{
	ViewData["Title"] = "Index";
}
@section Styles{
	<link href="~/css/table.css" rel="stylesheet" />
}

<h1 class="mt-3">房型管理</h1>

<div id="app" class="container">
<<<<<<< HEAD

	<div class="form-group">
		@*篩選欄位*@
		<div class="row" style="width:50%;margin-left:auto;margin-right:0px">
			<label class="col-md-4">關鍵字:</label>
			<input class="col-md-8 form-control" placeholder="請輸入篩選關鍵字"
				   v-model="filter" @@keyup="getRooms">
		</div>
	</div>
	<div class="form-group">
		@*新增按鍵*@
		<button type="button" @@click="showInsertPage" class="btn btn-primary btn-lg" data-bs-toggle="modal" data-bs-target="#modalId">
			新增加購服務選項
		</button>

	</div>
	<div class="form-group">
		<table class="table table-striped table-hover">
			<thead>
				<tr>
					<td>編輯</td>
					<td>RoomId</td>
					<td>HotelId</td>
					<td>Type</td>
					<td>Price</td>
					<td>MaxGuests</td>
				</tr>
			</thead>
			<tbody>
				<tr v-for="item in RoomsViewModel">
					<template v-if="item.Edit==true">

						<td>
							<button class="btn btn-success" @@click="update(item)">修改</button>
							<button class="btn btn-warning" @@click="cancel">取消</button>
						</td>
						<td>{{item.roomId}}</td>
						<td>{{item.hotelId}}</td>
						<td><input v-model="item.type" /> </td>
						<td><input v-model="item.price" /> </td>
						<td><input v-model="item.maxGuests" /> </td>



					</template>
					<template v-else>

						<td>
							<button class="btn btn-primary" @@click="edit(item.roomId)">編輯</button>
							<button class="btn btn-danger" @@click="deleteRooms(item.roomId)">刪除</button>
						</td>
=======
	<div class="table-responsive">
		<div class="table-wrapper">
			@*藍藍綠綠那一塊*@
			<div class="table-title">
				<div class="row">
					@*如果想來點查詢功能<input type="text" class="form-control" placeholder="請輸入篩選關鍵字" v-model="Filter" @@keyup="filterEmployeeDTOes" />*@
					<div>
						<button class="btn btn-info" @@click="showInsert()" data-toggle="modal"><span><i class="fa-solid fa-circle-plus"></i> 新增</span></button>
					</div>
				</div>
			</div>
			@*藍藍綠綠那一塊*@
			@*表格標題*@
			<table class="table table-striped table-hover">
				<thead>
					<tr>
						<td>RoomId</td>
						<td>HotelId</td>
						<td>Type</td>
						<th>Price</th>
						<th>MaxGuests</th>
					</tr>
				</thead>
				@*表格標題*@
				@*表格內容*@
				<tbody>
					<tr v-for="item in RoomsViewModel">
>>>>>>> Eric000
						<td>{{item.roomId}}</td>
						<td>{{item.hotelId}}</td>
						<td>{{item.type}}</td>
						<td>{{item.price}}</td>
						<td>{{item.maxGuests}}</td>
						<td>
							<a class="btn edit" @@click="edit(item.roomId)"><i class="fa-solid fa-pen" title="Edit"></i></a>
							<a class="btn delete" @@click="deleteRooms(item.roomId)"><i class="fa-solid fa-trash-can" title="Delete"></i></a>
						</td>
					</tr>
				</tbody>
				@*表格內容*@
			</table>

		</div>
		@*編輯用的互動視窗*@
		<div class="form-group">
			<div class="modal fade" id="editModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false" role="dialog" aria-labelledby="modalTitleId" aria-hidden="true">
				<div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-sm" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title" id="modalTitleId">編輯</h5>
							<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
						</div>
						<div class="modal-body">
							<div class="form-group">
								<label class="form-label">RoomId</label>
								<input class="form-control" v-model="originalRoomId" readonly />
							</div>
							<div class="form-group">
								<label class="form-label">HotelId</label>
								<input class="form-control" v-model="originalHotelId" readonly />
							</div>
							<div class="form-group">
								<label class="form-label">Type</label>
								<input class="form-control" v-model="originalType" />
							</div>
							<div class="form-group">
								<label class="form-label">Price</label>
								<input class="form-control" v-model="originalPrice" />
							</div>
							<div class="form-group">
								<label class="form-label">MaxGuests</label>
								<input class="form-control" v-model="originalMaxGuests" />
							</div>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">關閉</button>
							<button type="button" @@click="update" class="btn btn-primary">儲存</button>
						</div>
					</div>
				</div>
			</div>
		</div>
		@*新增用的互動視窗*@
		<div class="form-group">
			<div class="modal fade" id="insertModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false" role="dialog" aria-labelledby="modalTitleId" aria-hidden="true">
				<div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-sm" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title" id="modalTitleId">新增</h5>
							<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
						</div>
						<div class="modal-body">
							<div class="form-group">
								<label class="form-label">hotelId</label>
								<input class="form-control" v-model="hotelId" />
							</div>
							<div class="form-group">
								<label class="form-label">type</label>
								<input class="form-control" v-model="type" />
							</div>
							<div class="form-group">
								<label class="form-label">price</label>
								<input class="form-control" v-model="price" />
							</div>
							<div class="form-group">
								<label class="form-label">maxGuests</label>
								<input class="form-control" v-model="maxGuests" />
							</div>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">關閉</button>
							<button type="button" @@click="createRooms" class="btn btn-primary">新增</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<<<<<<< HEAD
@section Scripts{
		<script src="https://unpkg.com/vue@2.6.14/dist/vue.min.js"></script>
		<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
		<script>
			var app = new Vue({
				el: "#app",
				data: {
					RoomsViewModel: [],
					filter:"",
					hotelId:"",
					type: "",
					price: "",
					maxGuests: "",
					originalHotelId:"",
					originalType: "",
					originalPrice: "",
					originalMaxGuests: "",
				},
				mounted: function () {
					let _this=this;
					_this.getRooms();
				},
				methods: {
					//getRooms: function () {
					//	axios.get("Rooms/GetRooms")
					//		.then(response => {
					//			this.RoomsViewModel = response.data;
					//		})
					//		.catch(error => {
					//			console.log(error);
					//		});
					getRooms: function () {
						let _this = this;
						var request = {};
						request.RoomId = isNaN(Number(_this.filter)) ? -1 : Number(_this.filter);
						request.HotelId = request.Type = request.Price = request.MaxGuests = _this.filter;
						axios.post('Rooms/FilterRooms', request)
							.then(function (response) {
								_this.RoomsViewModel = response.data;
								var RoomList = [];
								for (var i = 0; i < _this.RoomsViewModel.length; i++) {
									var item = _this.RoomsViewModel[i];
									item.Edit = false;
									RoomList.push(item);
								}
								_this.RoomsViewModel = RoomList;
							})
							.catch(function (error) {
								console.log(error);
							});
					},
					showInsertPage: function () {
						$('#insertPage').modal('show');
					},
					createRooms: function () {
						let _this=this;
						var req = {
							RoomId:0,
							HotelId:_this.hotelId,
							Type: _this.type,
							Price: _this.price,
							MaxGuests: _this.maxGuests
						};
						axios.post("Rooms/CreateRooms", req)
							.then(response => {
								alert(response.data);
								$("#insertPage").modal('hide');
								_this.getRooms();
							})
					},
					update: function (item) {
						let _this=this
						var request = {
							RoomId:item.roomId,
							HotelId: item.hotelId,
							Type: item.type,
							Price: item.price,
							MaxGuests: item.maxGuests,
						};
						axios.post(`Rooms/Edit/${item.roomId}`, request)
							.then(response => {
								alert(response.data)
								_this.getRooms();
							});
					},
					cancel: function () {
						let _this=this;
						var RoomList=[];
						for (var i = 0; i < _this.RoomsViewModel.length; i++){
							var item= _this.RoomsViewModel[i];
							if(item.Edit==true){
								item.Edit=false;
								
								item.type = _this.originalType;
								item.price=_this.originalPrice;
								item.maxGuests=_this.originalMaxGuests;
							}
							RoomList.push(item);
						}
						_this.RoomsViewModel=RoomList;
					},
					edit: function (roomId) {
						let _this=this;
						var RoomList=[];
=======


@section Scripts{

	<script src="~/lib/vue/vue.min.js"></script>
	<script src="~/lib/axios/axios.min.js"></script>
	<script>
		const vm = new Vue({
			el: "#app",
			data: {
				RoomsViewModel: [],
				filter: "",
				hotelId: "",
				type: "",
				price: "",
				maxGuests: "",
				originalRoomId: "",
				originalHotelId: "",
				originalType: "",
				originalPrice: "",
				originalMaxGuests: "",
				roomId: "",
			},
			mounted: function () {
				let _this = this;
				_this.getRooms();
			},
			methods: {
				getRooms: function () {
					//alert("有！！");
					let _this = this;
					var request = {};
					request.RoomId = isNaN(Number(_this.filter)) ? -1 : Number(_this.filter);
					request.HotelId = request.Type = request.Price = request.MaxGuests = _this.filter;
					axios.post('Rooms/FilterRooms', request).then(function (response) {
						_this.RoomsViewModel = response.data;
						var RoomList = [];
>>>>>>> Eric000
						for (var i = 0; i < _this.RoomsViewModel.length; i++) {
							var item = _this.RoomsViewModel[i];
							RoomList.push(item);
						}
						_this.RoomsViewModel = RoomList;
					})
						.catch(function (error) {
							console.log(error);
						});
				},
				edit: function (roomId) {
					$("#editModal").modal("show");
					let _this = this;
					var RoomList = [];
					for (var i = 0; i < _this.RoomsViewModel.length; i++) {
						var item = _this.RoomsViewModel[i];
						if (roomId == item.roomId) {
							_this.originalRoomId = item.roomId;
							_this.originalHotelId = item.hotelId;
							_this.originalType = item.type;
							_this.originalPrice = item.price;
							_this.originalMaxGuests = item.maxGuests;
						} RoomList.push(item);
					}
					_this.RoomsViewModel = RoomList;
				},
				update: function () {
					let _this = this
					var request = {
						RoomId: _this.originalRoomId,
						HotelId: _this.originalHotelId,
						Type: _this.originalType,
						Price: _this.originalPrice,
						MaxGuests: _this.originalMaxGuests,
					};
					axios.post(`Rooms/Edit?ID=${_this.originalRoomId}`, request)
						.then(response => {
							alert(response.data);
							$("#editModal").modal('hide');
							_this.getRooms();
						});
				},

				showInsert: function () {
					$("#insertModal").modal("show");
				},
				createRooms: function () {
					let _this = this;
					var req = {
						RoomId: 0,
						HotelId: _this.hotelId,
						Type: _this.type,
						Price: _this.price,
						MaxGuests: _this.maxGuests
					};
					axios.post("Rooms/CreateRooms", req)
						.then(response => {
							alert(response.data);
							$("#insertModal").modal('hide');
							_this.getRooms();
						})
				},
				deleteRooms: function (roomId) {
					let _this = this;
					var ret = confirm("確定要刪除嗎？")
					if (ret == true) {
						axios.delete(`Rooms/DeleteConfirmed?ID=${roomId}`)
							.then(response => {
								alert(response.data);
								_this.getRooms();
							});
					}
				},
			}
		})
	</script>
}